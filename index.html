<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WUIZZIZZZ - Quiz Olimpiade IPS Keren!!!!</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            background: linear-gradient(135deg, #ff6b00, #f4c425);
            min-height: 100vh;
        }
        .dark-mode {
            background: linear-gradient(135deg, #333, #555);
            color: #fff;
        }
        .screen {
            display: none;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        }
        .screen.active {
            display: block;
        }
        .btn {
            transition: all 0.3s ease;
            z-index: 10;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .option:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .correct {
            animation: correct 0.5s ease;
        }
        .wrong {
            animation: wrong 0.5s ease;
        }
        @keyframes correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes wrong {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
        }
        .question-text {
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        /* Home Screen Styles */
        #homeScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
        }
        .logo {
            font-size: 4rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 0.5rem;
            animation: bounce 2s infinite;
        }
        .subtitle {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 2rem;
            font-weight: 600;
        }
        .welcome-text {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 800px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .welcome-text h2 {
            color: #ff6b00;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .welcome-text p {
            margin-bottom: 1rem;
            color: #333;
            text-align: left;
        }
        .start-btn {
            background: linear-gradient(135deg, #ff6b00, #f4c425);
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 1rem 3rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Quiz Screen Styles */
        #quizScreen {
            max-width: 800px;
            margin: 0 auto;
            padding-top: 3rem;
        }
        .nav-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .question-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .options {
            display: grid;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .option {
            background: #f4c425;
            color: #333;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: left;
        }
        
        /* Countdown Screen */
        #countdownScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
        }
        .countdown-number {
            font-size: 10rem;
            color: white;
            font-weight: bold;
            animation: zoomIn 0.5s;
        }
        
        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes zoomOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0); opacity: 0; }
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
            }
            .subtitle {
                font-size: 1.2rem;
            }
            .welcome-text {
                padding: 1rem;
            }
            .start-btn {
                padding: 0.8rem 2rem;
                font-size: 1rem;
            }
            .question-text {
                font-size: 1rem;
            }
            .countdown-number {
                font-size: 6rem;
            }
            .options {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) {
            .options {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">üåô</div>

    <!-- Home Screen -->
    <div id="homeScreen" class="screen active">
        <div class="logo">WUIZZIZZZ</div>
        <div class="subtitle">Quiz Seru - Olimpiade Sains IPS</div>
        
        <div class="welcome-text">
            <h2>üéØ Siap Jadi Juara Olimpiade IPS? üèÜ</h2>
            <p>Halo para calon juara! Selamat datang di WUIZZIZZZ, tempat terbaik untuk berlatih soal-soal Olimpiade IPS. Kamu akan menghadapi 50 soal pilihan ganda yang menantang dan seru. Setiap soal punya waktu 30 detik, jadi pastikan kamu fokus dan percaya diri!</p>
            <p><strong>üí° Tips:</strong> Baca soal dengan teliti, jangan terburu-buru, dan ingat - setiap kesalahan adalah pembelajaran!</p>
            <p><strong>üî• Power-up:</strong> Dapatkan +10 detik bonus jika menjawab dalam 10 detik pertama!</p>
        </div>
        
        <button class="start-btn" onclick="startCountdown()">üöÄ MULAI KUIS</button>
    </div>

    <!-- Countdown Screen -->
    <div id="countdownScreen" class="screen">
        <div class="countdown-number">3</div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="screen">
        <div class="nav-card">
            <div class="score text-lg font-semibold text-orange-500">Skor: 0</div>
            <div class="powerup hidden text-2xl pulse">üî•</div>
            <div class="timer flex items-center">
                <div class="timer-bar w-32 h-2 bg-gray-300 rounded-full overflow-hidden mr-2">
                    <div class="timer-progress h-full bg-yellow-400 transition-all" style="width: 100%;"></div>
                </div>
                <span class="timer-text text-gray-600">30 detik</span>
            </div>
        </div>
        <div class="question-card">
            <div class="question-number text-lg font-semibold text-gray-600 mb-2"></div>
            <div class="question-text mb-4"></div>
            <div class="options grid gap-3"></div>
            <div class="short-answer hidden">
                <input type="text" class="w-full p-3 border-2 border-orange-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-300" placeholder="Masukkan jawaban (HURUF BESAR, TANPA TANDA BACA)">
                <button class="btn bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold mt-3" onclick="checkShortAnswer()">Kirim</button>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="screen">
        <div class="bg-white rounded-2xl p-8 shadow-lg max-w-3xl mx-auto mt-8">
            <h2 class="text-2xl font-bold text-orange-500 mb-4">Hasil Kuis</h2>
            <p id="total-score" class="text-lg mb-2"></p>
            <p id="correct-answers" class="text-lg mb-2"></p>
            <p id="time-taken" class="text-lg mb-4"></p>
            <div class="redemption hidden mb-4">
                <h3 class="text-lg font-semibold text-gray-600">Redemption Quiz</h3>
                <p class="text-gray-600 mb-2">Pilih hingga 3 soal yang salah/tidak dijawab untuk dijawab ulang:</p>
                <div id="redemption-options" class="flex flex-wrap gap-2"></div>
                <button class="btn bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold mt-3" onclick="startRedemption()">Mulai Redemption</button>
            </div>
            <div class="flex gap-4 justify-center">
                <button class="btn bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold" onclick="playAgain()">Main Lagi</button>
                <button class="btn bg-yellow-400 text-gray-800 px-6 py-3 rounded-lg font-semibold" onclick="shareScore()">Bagikan Skor</button>
            </div>
            <div class="leaderboard mt-6">
                <h3 class="text-lg font-semibold text-gray-600">Leaderboard</h3>
                <ul id="leaderboard-list" class="text-left"></ul>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            // 30 Multiple-Choice Questions (Challenging, OSN IPS Level)
            {
                type: "multiple",
                text: "Luas laut Indonesia mencakup 2/3 dari seluruh luas wilayah Indonesia dan memiliki garis pantai terpanjang kedua di dunia. Salah satu potensi sumber daya air laut adalah pemanfaatannya untuk pembuatan garam. Secara geografis, wilayah yang paling berpotensi untuk mendukung kegiatan tersebut adalah pesisir ....",
                options: ["Utara Papua", "Timur Kalimantan", "Selatan Sulawesi", "Barat Sumatera"],
                correct: "C"
            },
            {
                type: "multiple",
                text: "Interaksi lempeng tektonik Indo-Australia dan Eurasia menghasilkan zona subduksi yang memengaruhi aktivitas vulkanik di Indonesia. Fenomena ini paling dominan di wilayah ....",
                options: ["Cincin Api Pasifik", "Dataran Sunda", "Lempeng Sahul", "Pegunungan Himalaya"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Pada masa kolonial Belanda, sistem tanam paksa (Cultuurstelsel) menyebabkan penderitaan petani karena ....",
                options: ["Pajak tanah yang tinggi", "Pengalihan lahan untuk tanaman ekspor", "Peningkatan harga pangan", "Monopoli perdagangan lokal"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Kerajaan Sriwijaya menguasai perdagangan di Selat Malaka pada abad ke-7. Komoditas utama yang meningkatkan kekayaannya adalah ....",
                options: ["Emas", "Lada", "Cengkeh", "Kayu cendana"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Konferensi Meja Bundar 1949 menghasilkan pengakuan kedaulatan Indonesia dengan pembentukan negara ....",
                options: ["Republik Indonesia Serikat", "Negara Indonesia Timur", "Kesultanan Yogyakarta", "Republik Maluku Selatan"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Sistem matrilineal pada masyarakat Minangkabau mengatur warisan berdasarkan garis ....",
                options: ["Ayah", "Ibu", "Kakek", "Paman"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Faktor utama masuknya pengaruh Hindu-Buddha ke Indonesia adalah aktivitas ....",
                options: ["Perang antarkerajaan", "Perdagangan maritim", "Penjajahan Eropa", "Migrasi besar-besaran"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Wilayah Indonesia dengan potensi energi geotermal terbesar karena aktivitas vulkaniknya adalah ....",
                options: ["Sumatera Utara", "Jawa Barat", "Sulawesi Utara", "Nusa Tenggara Timur"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Sistem landrent pada masa kolonial Inggris di Jawa berfokus pada ....",
                options: ["Pajak tanah berdasarkan luas lahan", "Eksploitasi tenaga kerja", "Monopoli rempah", "Pengelolaan irigasi"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Perlawanan Pangeran Diponegoro dipicu oleh penyalahgunaan tanah untuk pembangunan ....",
                options: ["Jalan Anyer-Panarukan", "Benteng Stelsel", "Jembatan Kali Mas", "Pelabuhan Sunda Kelapa"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Sumber daya alam di Kalimantan yang menjadi penyumbang devisa terbesar adalah ....",
                options: ["Minyak bumi", "Batu bara", "Emas", "Kayu"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Candi Borobudur mencerminkan pengaruh agama Buddha aliran ....",
                options: ["Theravada", "Mahayana", "Hinayana", "Vajrayana"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Budi Utomo (1908) bertujuan untuk memajukan ....",
                options: ["Pendidikan dan budaya", "Perlawanan bersenjata", "Pemisahan wilayah Jawa", "Partai politik"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Wilayah Indonesia dengan keanekaragaman flora dan fauna tipe Australis adalah ....",
                options: ["Jawa", "Sumatera", "Papua", "Kalimantan"],
                correct: "C"
            },
            {
                type: "multiple",
                text: "Pelabuhan utama pada masa kolonial Portugis di Indonesia adalah ....",
                options: ["Banten", "Malaka", "Makassar", "Surabaya"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Sistem Subak di Bali mengatur distribusi air untuk lahan ....",
                options: ["Sawah", "Kebun", "Tambak", "Tegalan"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Penyebab utama keruntuhan Kerajaan Majapahit adalah ....",
                options: ["Perang Paregreg", "Penjajahan Belanda", "Bencana alam", "Krisis ekonomi"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Sumber daya mineral dominan di Bangka Belitung adalah ....",
                options: ["Timah", "Tembaga", "Nikel", "Besi"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Pahlawan nasional yang memimpin perlawanan di Maluku adalah ....",
                options: ["Sultan Hasanuddin", "Pattimura", "Tuanku Imam Bonjol", "Cut Nyak Dien"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Konferensi Asia-Afrika 1955 di Bandung bertujuan untuk ....",
                options: ["Memperkuat blok komunis", "Mempromosikan perdamaian dunia", "Mendirikan ASEAN", "Menentang kemerdekaan Indonesia"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Struktur ekonomi feodal Kerajaan Mataram Kuno didasarkan pada ....",
                options: ["Perdagangan maritim", "Pajak tanah sawah", "Monopoli rempah", "Perkebunan lada"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Wilayah Indonesia yang terkenal dengan kopi Gayo adalah ....",
                options: ["Aceh", "Jawa Barat", "Toraja", "Sumatera Utara"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "VOC mendirikan benteng di .... untuk menguasai perdagangan rempah pada masa kolonial Belanda.",
                options: ["Jakarta", "Ambon", "Surabaya", "Banten"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Faktor iklim yang paling memengaruhi persebaran flora di Indonesia adalah ....",
                options: ["Tekanan udara", "Curah hujan", "Ketinggian tanah", "Suhu rata-rata"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Perlawanan Sultan Hasanuddin di Gowa dipicu oleh monopoli perdagangan oleh ....",
                options: ["Portugis", "Belanda", "Inggris", "Spanyol"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Sistem ekonomi tradisional masyarakat Bugis-Makassar dikenal sebagai ....",
                options: ["Subak", "Ladang berpindah", "Pattun", "Sawah"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Candi Prambanan merupakan peninggalan agama ....",
                options: ["Buddha", "Hindu", "Islam", "Kristen"],
                correct: "B"
            },
            {
                type: "multiple",
                text: "Sumber daya alam utama di Riau yang menyumbang devisa adalah ....",
                options: ["Minyak bumi", "Timah", "Emas", "Nikel"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Sarekat Islam awalnya bertujuan untuk memajukan ....",
                options: ["Perdagangan pribumi", "Perlawanan politik", "Pendidikan modern", "Pemisahan agama"],
                correct: "A"
            },
            {
                type: "multiple",
                text: "Perjanjian Linggarjati mengakui kedaulatan Indonesia atas wilayah ....",
                options: ["Jawa dan Madura", "Sumatera", "Kalimantan", "Sulawesi"],
                correct: "A"
            },
            // 20 Short-Answer Questions (Challenging, OSN IPS Level)
            {
                type: "short",
                text: "Persebaran flora dan fauna di Indonesia dipengaruhi oleh sejarah geologis pada masa zaman es. Dataran Sunda bersatu dengan Asia, sedangkan Dataran .... menyatu dengan Australia.",
                correct: "SAHUL"
            },
            {
                type: "short",
                text: "Kerajaan Islam pertama di Indonesia yang menjadi pusat pendidikan agama pada abad ke-16 adalah ....",
                correct: "DEMAK"
            },
            {
                type: "short",
                text: "Gunung berapi yang menyebabkan bencana global pada tahun 1815 akibat letusannya adalah ....",
                correct: "TAMBORA"
            },
            {
                type: "short",
                text: "Sistem tanam paksa pada masa kolonial Belanda di Jawa dikenal sebagai ....",
                correct: "CULTUURSTELSEL"
            },
            {
                type: "short",
                text: "Pahlawan nasional yang memimpin Perang Padri di Minangkabau adalah ....",
                correct: "TUANKU IMAM BONJOL"
            },
            {
                type: "short",
                text: "Provinsi dengan potensi wisata bahari terbesar karena kepulauan karangnya adalah ....",
                correct: "NUSA TENGGARA TIMUR"
            },
            {
                type: "short",
                text: "Sistem tradisional Bali yang mengatur irigasi sawah disebut ....",
                correct: "SUBAK"
            },
            {
                type: "short",
                text: "Organisasi internasional yang didirikan Indonesia bersama negara Asia Tenggara pada 1967 adalah ....",
                correct: "ASEAN"
            },
            {
                type: "short",
                text: "Provinsi Maluku yang terkenal dengan rumah adatnya adalah ....",
                correct: "BAILEO"
            },
            {
                type: "short",
                text: "Perjanjian yang mengakhiri kekuasaan Belanda di Indonesia pada 1949 adalah ....",
                correct: "KONFERENSI MEJA BUNDAR"
            },
            {
                type: "short",
                text: "Sumber daya alam utama di Papua yang dikelola oleh Freeport adalah ....",
                correct: "TEMBAGA"
            },
            {
                type: "short",
                text: "Tarian Aceh yang diakui UNESCO sebagai warisan budaya adalah ....",
                correct: "SAMAN"
            },
            {
                type: "short",
                text: "Wilayah Indonesia penghasil timah terbesar adalah ....",
                correct: "BANGKA BELITUNG"
            },
            {
                type: "short",
                text: "Pahlawan nasional yang memimpin perlawanan Puputan di Bali adalah ....",
                correct: "I GUSTI NGURAH RAI"
            },
            {
                type: "short",
                text: "Sistem VOC untuk menguasai perdagangan rempah di Ambon disebut ....",
                correct: "HONGI TOCHTEN"
            },
            {
                type: "short",
                text: "Gunung berapi aktif di Jawa Tengah dengan nilai sejarah dan budaya adalah ....",
                correct: "MERAPI"
            },
            {
                type: "short",
                text: "Organisasi pergerakan nasional yang didirikan pelajar STOVIA pada 1908 adalah ....",
                correct: "BUDI UTOMO"
            },
            {
                type: "short",
                text: "Sumber daya alam penyumbang devisa terbesar di Kalimantan Timur adalah ....",
                correct: "MINYAK BUMI"
            },
            {
                type: "short",
                text: "Sistem sosial perkawinan masyarakat Batak disebut ....",
                correct: "DALIHAH TOLU"
            },
            {
                type: "short",
                text: "Konferensi internasional di Bandung pada 1955 disebut ....",
                correct: "KONFERENSI ASIA AFRIKA"
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let correctAnswers = 0;
        let startTime = null;
        let timerInterval = null;
        let timeLeft = 30;
        let totalTime = 0;
        let answers = [];
        let redemptionQuestions = [];

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startCountdown() {
            showScreen('countdownScreen');
            const countdownElement = document.querySelector('.countdown-number');
            let count = 3;
            
            const countdownInterval = setInterval(() => {
                countdownElement.textContent = count;
                count--;
                
                if (count < 0) {
                    clearInterval(countdownInterval);
                    countdownElement.style.animation = 'zoomOut 0.5s forwards';
                    setTimeout(() => {
                        startQuiz();
                    }, 500);
                }
            }, 1000);
        }

        function startQuiz() {
            showScreen('quizScreen');
            startTime = new Date();
            answers = Array(questions.length).fill(null);
            redemptionQuestions = [];
            currentQuestion = 0;
            score = 0;
            correctAnswers = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[currentQuestion];
            timeLeft = q.type === "multiple" ? 30 : 45;
            document.querySelector('.question-number').textContent = `Soal ${currentQuestion + 1}/${questions.length}`;
            document.querySelector('.question-text').textContent = q.text;
            document.querySelector('.score').textContent = `Skor: ${score}`;
            document.querySelector('.powerup').classList.add('hidden');

            const optionsDiv = document.querySelector('.options');
            const shortAnswerDiv = document.querySelector('.short-answer');
            optionsDiv.innerHTML = '';
            shortAnswerDiv.classList.add('hidden');

            if (q.type === "multiple") {
                optionsDiv.classList.remove('hidden');
                q.options.forEach((option, i) => {
                    const btn = document.createElement('div');
                    btn.classList.add('option', 'bg-yellow-400', 'text-gray-800', 'p-4', 'rounded-lg', 'transition-all');
                    btn.textContent = `${String.fromCharCode(65 + i)}. ${option}`;
                    btn.onclick = () => checkAnswer(String.fromCharCode(65 + i));
                    optionsDiv.appendChild(btn);
                });
            } else {
                shortAnswerDiv.classList.remove('hidden');
                optionsDiv.classList.add('hidden');
                const input = document.querySelector('.short-answer input');
                input.value = '';
                input.disabled = false;
                input.classList.remove('border-green-500', 'border-red-500');
                document.querySelector('.short-answer .btn').disabled = false;
            }

            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            const timerProgress = document.querySelector('.timer-progress');
            const timerText = document.querySelector('.timer-text');
            timerProgress.style.width = '100%';
            timerText.textContent = `${timeLeft} detik`;

            timerInterval = setInterval(() => {
                timeLeft--;
                totalTime++;
                timerText.textContent = `${timeLeft} detik`;
                timerProgress.style.width = `${(timeLeft / (questions[currentQuestion].type === "multiple" ? 30 : 45)) * 100}%`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer(null);
                }
            }, 1000);
        }

        function checkAnswer(answer) {
            clearInterval(timerInterval);
            const q = questions[currentQuestion];
            let isCorrect = false;

            answers[currentQuestion] = { answer, isCorrect: false };

            if (q.type === "multiple") {
                const options = document.querySelectorAll('.option');
                options.forEach((opt, i) => {
                    if (String.fromCharCode(65 + i) === q.correct) {
                        opt.classList.add('correct', 'bg-green-500', 'text-white');
                    } else if (String.fromCharCode(65 + i) === answer) {
                        opt.classList.add('wrong', 'bg-red-500', 'text-white');
                    }
                    opt.onclick = null;
                });
                isCorrect = answer === q.correct;
            } else {
                const userAnswer = document.querySelector('.short-answer input').value.toUpperCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, "");
                isCorrect = userAnswer === q.correct;
                const input = document.querySelector('.short-answer input');
                input.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                input.disabled = true;
                document.querySelector('.short-answer .btn').disabled = true;
            }

            answers[currentQuestion].isCorrect = isCorrect;

            if (isCorrect) {
                score += 10;
                correctAnswers++;
                if (timeLeft > (q.type === "multiple" ? 20 : 35)) {
                    totalTime -= 10;
                    document.querySelector('.powerup').classList.remove('hidden');
                    Swal.fire({
                        title: 'Power-up!',
                        text: 'Kamu mendapat +10 detik karena menjawab dalam waktu kurang dari 10 detik! üî•',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false,
                        confirmButtonColor: '#ff6b00'
                    });
                }
            }

            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    loadQuestion();
                } else {
                    showResult();
                }
            }, 1000);
        }

        function checkShortAnswer() {
            const answer = document.querySelector('.short-answer input').value;
            checkAnswer(answer);
        }

        function showResult() {
            showScreen('resultScreen');
            const timeTaken = Math.floor((new Date() - startTime) / 1000);
            document.getElementById('total-score').textContent = `Skor Total: ${score}`;
            document.getElementById('correct-answers').textContent = `Jawaban Benar: ${correctAnswers}/${questions.length}`;
            document.getElementById('time-taken').textContent = `Waktu: ${Math.floor(timeTaken / 60)} menit ${timeTaken % 60} detik`;

            const incorrectQuestions = answers
                .map((ans, i) => ({ index: i, isCorrect: ans ? ans.isCorrect : false }))
                .filter(ans => !ans.isCorrect)
                .map(ans => ans.index);

            if (incorrectQuestions.length > 0) {
                document.querySelector('.redemption').classList.remove('hidden');
                const redemptionOptions = document.getElementById('redemption-options');
                redemptionOptions.innerHTML = '';
                incorrectQuestions.forEach(i => {
                    const btn = document.createElement('button');
                    btn.classList.add('btn', 'bg-gray-200', 'text-gray-800', 'px-3', 'py-1', 'rounded-lg');
                    btn.textContent = `Soal ${i + 1}`;
                    btn.onclick = () => toggleRedemptionQuestion(i);
                    redemptionOptions.appendChild(btn);
                });
            }

            updateLeaderboard(score, timeTaken);
        }

        function toggleRedemptionQuestion(index) {
            if (redemptionQuestions.includes(index)) {
                redemptionQuestions = redemptionQuestions.filter(i => i !== index);
            } else if (redemptionQuestions.length < 3) {
                redemptionQuestions.push(index);
            } else {
                Swal.fire({
                    title: 'Batas Tercapai',
                    text: 'Kamu hanya bisa memilih 3 soal untuk redemption quiz!',
                    icon: 'warning',
                    timer: 1500,
                    showConfirmButton: false,
                    confirmButtonColor: '#ff6b00'
                });
                return;
            }
            const buttons = document.querySelectorAll('#redemption-options button');
            buttons.forEach(btn => {
                const i = parseInt(btn.textContent.replace('Soal ', '')) - 1;
                btn.classList.toggle('bg-orange-500', redemptionQuestions.includes(i));
                btn.classList.toggle('text-white', redemptionQuestions.includes(i));
                btn.classList.toggle('bg-gray-200', !redemptionQuestions.includes(i));
                btn.classList.toggle('text-gray-800', !redemptionQuestions.includes(i));
            });
        }

        function startRedemption() {
            if (redemptionQuestions.length === 0) {
                Swal.fire({
                    title: 'Pilih Soal',
                    text: 'Silakan pilih minimal satu soal untuk redemption quiz!',
                    icon: 'warning',
                    timer: 1500,
                    showConfirmButton: false,
                    confirmButtonColor: '#ff6b00'
                });
                return;
            }
            currentQuestion = redemptionQuestions[0];
            redemptionQuestions = redemptionQuestions.slice(1);
            score -= answers.filter(ans => ans && ans.isCorrect).length * 10;
            correctAnswers = 0;
            answers = Array(questions.length).fill(null);
            showScreen('quizScreen');
            loadQuestion();
        }

        function updateLeaderboard(score, timeTaken) {
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            Swal.fire({
                title: 'Masukkan Nama',
                input: 'text',
                inputPlaceholder: 'Nama untuk leaderboard',
                showCancelButton: true,
                confirmButtonText: 'Simpan',
                confirmButtonColor: '#ff6b00',
                cancelButtonColor: '#f4c425'
            }).then(result => {
                if (result.isConfirmed && result.value) {
                    leaderboard.push({ name: result.value, score, time: timeTaken });
                    leaderboard.sort((a, b) => b.score - a.score || a.time - b.time);
                    localStorage.setItem('leaderboard', JSON.stringify(leaderboard.slice(0, 5)));

                    const list = document.getElementById('leaderboard-list');
                    list.innerHTML = '';
                    leaderboard.slice(0, 5).forEach((entry, i) => {
                        const li = document.createElement('li');
                        li.classList.add('bg-yellow-400', 'text-gray-800', 'p-2', 'rounded', 'my-1');
                        li.textContent = `${i + 1}. ${entry.name}: ${entry.score} (${Math.floor(entry.time / 60)}m ${entry.time % 60}s)`;
                        list.appendChild(li);
                    });
                }
            });
        }

        function playAgain() {
            showScreen('homeScreen');
        }

        function shareScore() {
            Swal.fire({
                title: 'Bagikan Skor',
                text: 'Fitur ini belum diimplementasikan. Silakan screenshot hasilmu!',
                icon: 'info',
                confirmButtonColor: '#ff6b00'
            });
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.querySelectorAll('.bg-white').forEach(el => el.classList.toggle('dark:bg-gray-800'));
            document.querySelectorAll('.text-gray-600').forEach(el => el.classList.toggle('dark:text-gray-300'));
        }
    </script>
</body>
</html>
